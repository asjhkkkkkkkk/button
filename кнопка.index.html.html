<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Electronic Assistant — Запись ответа</title>
<style>
  body { font-family: system-ui, Arial; max-width:760px; margin:20px; }
  button { margin-right:6px; margin-top:10px; }
  #timer { font-weight:600; width:64px; display:inline-block; }
</style>
</head>
<body>
<h3>Запишите свой ответ</h3>

<div>
  <button id="startBtn">▶ Начать запись (40 секунд)</button>
  <button id="downloadBtn" disabled>⬇ Скачать запись</button>
  <span id="status" style="margin-left:8px; color:#374151">Готово</span>
</div>

<div style="margin-top:12px">
  <span id="timer">00:00</span>
  <div style="width:100%; height:8px; background:#e5e7eb; border-radius:99px; overflow:hidden; margin-top:4px;">
    <div id="bar" style="width:0%; height:100%; background:#3b82f6; transition:width .2s linear"></div>
  </div>
</div>

<script>
let mediaRecorder;
let recordedChunks = [];

const startBtn = document.getElementById('startBtn');
const downloadBtn = document.getElementById('downloadBtn');
const status = document.getElementById('status');
const timerEl = document.getElementById('timer');
const bar = document.getElementById('bar');

startBtn.onclick = async () => {
  startBtn.disabled = true;
  downloadBtn.disabled = true;
  status.textContent = 'Запись...';

  recordedChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);

  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };

  mediaRecorder.start();

  // таймер 40 секунд
  let seconds = 40;
  timerEl.textContent = `00:40`;
  bar.style.width = '0%';
  const interval = setInterval(() => {
    seconds--;
    timerEl.textContent = `00:${seconds.toString().padStart(2,'0')}`;
    bar.style.width = `${((40-seconds)/40)*100}%`;
    if (seconds <= 0) {
      clearInterval(interval);
      mediaRecorder.stop();
      status.textContent = 'Запись завершена';
      downloadBtn.disabled = false;
      startBtn.disabled = false;
    }
  }, 1000);
};

downloadBtn.onclick = () => {
  const blob = new Blob(recordedChunks, { type: 'audio/webm' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'answer.webm';
  a.click();
};
</script>
</body>
</html>
